// vim: syntax=c
#include "utils.h"
#include <stdbool.h>

schar intCompare(const int *a, const int *b) { return (*a < *b)? -1 : ((*a > *b)? 1 : 0); }

#suite utils

#test stringLenT
    ck_assert_int_eq(stringLen("test"), 4);
    ck_assert_int_eq(stringLen(""), 0);

#test hashCodeT
    ck_assert_uint_eq(calcHashCode(""),           2166136261);
    ck_assert_uint_eq(calcHashCode("a"),          3826002220);
    ck_assert_uint_eq(calcHashCode("ab"),         1294271946);
    ck_assert_uint_eq(calcHashCode("test"),       2949673445);
    ck_assert_uint_eq(calcHashCode("tset"),       4291670689);
    ck_assert_uint_eq(calcHashCode("MyInfoItem"), 3974904096);
    ck_assert_uint_eq(calcHashCodeL("test", 4),   2949673445);
    ck_assert_uint_eq(calcHashCode("costarring"), calcHashCode("liquid")); // check correctness against known collision

    PartialHash phash = emptyPartialHash;
    calcHashCodeC('a', &phash);
    calcHashCodeC('b', &phash);
    calcHashCodeC('c', &phash);
    ck_assert_uint_eq(phash.hash, calcHashCode("abc"));

#test binarySearchT
#define assertBinarySearchInt(arr, search, expectedRes, expectedRet) \
    needle = search; \
    returnCode = binarySearch(arr, &needle, sizeof(arr)/sizeof(*arr), sizeof(*arr), (compareFunc) intCompare, &result); \
    ck_assert_int_eq(returnCode, expectedRet); \
    ck_assert_int_eq(result, expectedRes) \

    int needle, returnCode, result;

    int arr1[] = {1, 3};
    assertBinarySearchInt(arr1, 0, 0, false);
    assertBinarySearchInt(arr1, 4, 2, false);
    assertBinarySearchInt(arr1, 1, 0, true);
    assertBinarySearchInt(arr1, 3, 1, true);
    assertBinarySearchInt(arr1, 2, 1, false);

    int arr2[] = {1, 3, 8, 11, 27, 50, 60, 70, 80, 90, 99};
    assertBinarySearchInt(arr2, 0,   0,  false);
    assertBinarySearchInt(arr2, 100, 11, false);
    assertBinarySearchInt(arr2, 77,  8,  false);
    assertBinarySearchInt(arr2, 1,   0,  true);
    assertBinarySearchInt(arr2, 3,   1,  true);
    assertBinarySearchInt(arr2, 8,   2,  true);
    assertBinarySearchInt(arr2, 11,  3,  true);
    assertBinarySearchInt(arr2, 27,  4,  true);
    assertBinarySearchInt(arr2, 50,  5,  true);
    assertBinarySearchInt(arr2, 60,  6,  true);
    assertBinarySearchInt(arr2, 70,  7,  true);
    assertBinarySearchInt(arr2, 80,  8,  true);
    assertBinarySearchInt(arr2, 90,  9,  true);
    assertBinarySearchInt(arr2, 99,  10, true);

#test otherT
    ck_assert_uint_gt(getTimestamp(), 1611779299);

